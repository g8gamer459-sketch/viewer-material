<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>Jardim para a Minha Namorada üíó</title>
  <style>
    :root{
      --accent:#b4388f; --petal:#ffe3f1; --petal-stroke:#e6a4c7; --center:#ffd86b; --center-stroke:#e6b84a;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%;overflow:hidden}

    body{
      background: linear-gradient(135deg, #fff1f8 0%, #f7e7ff 50%, #ffeef6 100%);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      -webkit-tap-highlight-color: transparent;
      display:flex;
      justify-content:center;
      align-items:center;
      position:relative;
      touch-action: manipulation;
      -webkit-overflow-scrolling: touch; /* Melhora scrolling no iOS */
    }

    #garden{
      position:absolute;
      inset:0;
      overflow:hidden;
      touch-action: none;
      /* For√ßar acelera√ß√£o de hardware para melhor performance */
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
    }

    .lily{
      position:absolute;
      width:22vmin;
      height:22vmin;
      transform:translate(-50%, -50%) scale(0.2);
      transform-origin:center;
      filter: drop-shadow(0 8px 20px rgba(180,56,143,.28));
      opacity:0;
      /* Transi√ß√µes otimizadas para mobile */
      transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s ease;
      pointer-events:none;
      z-index: 1;
      /* For√ßar acelera√ß√£o de hardware */
      will-change: transform, opacity;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }

    .lily.pop{
      opacity:1;
      transform:translate(-50%, -50%) scale(1) rotate(var(--rot, 0deg));
    }

    /* Anima√ß√£o adicional para as flores - otimizada para mobile */
    @keyframes float {
      0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(var(--rot, 0deg)); }
      50% { transform: translate(-50%, -52%) scale(1.02) rotate(var(--rot, 0deg)); }
    }

    .lily.pop {
      animation: float 4s ease-in-out infinite;
    }

    #clickHint{
      position:fixed;
      top:50%;left:50%;transform:translate(-50%, -50%);
      width:100%;
      text-align:center;
      font-size:3.5vmin;
      color:#d1469c;
      opacity:0.25;
      font-weight:300;
      letter-spacing:0.6em;
      pointer-events:none;
      font-family:'Helvetica Neue','Roboto','Segoe UI',sans-serif;
      animation:fadeHint 3s ease-in-out infinite alternate;
      z-index: 2;
      /* Otimiza√ß√£o para mobile */
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    @keyframes fadeHint{
      0% { opacity: 0.22; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0.36; transform: translate(-50%, -50%) scale(1.05); }
    }

    #reset{
      position:fixed;
      right:2vmin;bottom:2vmin;
      background:var(--accent);
      border:none;color:white;
      padding:1vmin 2.4vmin;
      border-radius:999px;
      font-size:2vmin;font-weight:600;
      box-shadow:0 6px 18px rgba(0,0,0,.18);
      z-index:10;
      cursor: pointer;
      touch-action: manipulation;
      transition: all 0.2s ease;
      /* Melhorar apar√™ncia no mobile */
      -webkit-appearance: none;
      appearance: none;
    }

    #reset:active{
      transform: scale(0.95);
      box-shadow:0 3px 9px rgba(0,0,0,.18);
    }

    /* Melhorias para dispositivos m√≥veis */
    @media (max-width: 768px) {
      #reset {
        padding: 1.5vmin 3vmin;
        font-size: 2.5vmin;
      }
      
      #clickHint {
        font-size: 4vmin;
        letter-spacing: 0.4em;
        padding: 0 2vmin;
      }
      
      .lily {
        width: 25vmin;
        height: 25vmin;
      }
    }

    /* Para telas muito pequenas */
    @media (max-width: 480px) {
      #clickHint {
        font-size: 3.5vmin;
        letter-spacing: 0.2em;
      }
    }

    .max-note{
      position:fixed;
      left:50%;bottom:4vmin;
      transform:translateX(-50%);
      background:#ffffffdd;
      border-radius:999px;
      padding:1vmin 2.6vmin;
      font-size:2.2vmin;
      border:1px solid #efc8e5;
      opacity:0;
      transition:opacity .3s ease;
      z-index: 10;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }

    .max-note.show{
      opacity:1;
      animation: pulse 1.2s ease-in-out;
    }

    @keyframes pulse {
      0% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.1); }
      100% { transform: translateX(-50%) scale(1); }
    }

    /* Indicador de toque para mobile */
    .touch-indicator {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(180, 56, 143, 0.3);
      transform: translate(-50%, -50%) scale(0);
      pointer-events: none;
      z-index: 5;
    }
    
    .touch-indicator.active {
      animation: touchRipple 0.6s ease-out;
    }
    
    @keyframes touchRipple {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
    }
  </style>
</head>
<body>

  <div id="garden"></div>
  <div id="clickHint">TOCA NO ECR√É üíï</div>
  <div class="max-note" id="maxNote">Limite atingido üíó</div>
  <button id="reset">Limpar</button>

<script>
const garden = document.getElementById('garden');
const maxNote = document.getElementById('maxNote');
const resetBtn = document.getElementById('reset');
const MAX = 70;
let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// Previne comportamentos padr√£o indesejados em dispositivos m√≥veis
document.addEventListener('touchmove', function(e) {
  if (e.scale !== 1) { e.preventDefault(); }
}, { passive: false });

document.addEventListener('gesturestart', function(e) {
  e.preventDefault();
});

// Detectar se √© um dispositivo com touch
function hasTouch() {
  return 'ontouchstart' in document.documentElement ||
         navigator.maxTouchPoints > 0 ||
         navigator.msMaxTouchPoints > 0;
}

// Criar efeito visual de toque
function createTouchIndicator(x, y) {
  if (!hasTouch()) return;
  
  const indicator = document.createElement('div');
  indicator.className = 'touch-indicator active';
  indicator.style.left = x + 'px';
  indicator.style.top = y + 'px';
  
  garden.appendChild(indicator);
  
  // Remover ap√≥s a anima√ß√£o
  setTimeout(() => {
    if (indicator.parentNode) {
      indicator.parentNode.removeChild(indicator);
    }
  }, 600);
}

function makeLilySVG(){
  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS,'svg');
  svg.setAttribute('viewBox','0 0 200 200');
  svg.setAttribute('width','100%');
  svg.setAttribute('height','100%');

  const flowerG = document.createElementNS(svgNS,'g');
  flowerG.setAttribute('transform','matrix(0.95,-0.14,0.08,0.92,10,0)');

  for(let i=0;i<5;i++){
    const g = document.createElementNS(svgNS,'g');
    g.setAttribute('fill','var(--petal)');
    g.setAttribute('stroke','var(--petal-stroke)');
    g.setAttribute('stroke-width','2');
    g.setAttribute('transform',`rotate(${i*72} 100 100)`);
    const path = document.createElementNS(svgNS,'path');
    path.setAttribute('d','M100 20 C78 42, 60 92, 100 146 C140 92, 122 42, 100 20');
    g.appendChild(path);
    flowerG.appendChild(g);
  }

  const center = document.createElementNS(svgNS,'circle');
  center.setAttribute('cx','100'); center.setAttribute('cy','100'); center.setAttribute('r','18');
  center.setAttribute('fill','var(--center)'); center.setAttribute('stroke','var(--center-stroke)');
  center.setAttribute('stroke-width','2');
  flowerG.appendChild(center);

  svg.appendChild(flowerG);
  return svg;
}

function plantLilyAt(x,y){
  if(garden.childElementCount >= MAX){
    maxNote.classList.add('show');
    setTimeout(()=>maxNote.classList.remove('show'),1200);
    return;
  }

  const lily = document.createElement('div');
  lily.className='lily';
  lily.style.left = x + 'px';
  lily.style.top = y + 'px';
  
  // Adicionar rota√ß√£o aleat√≥ria
  const rotation = (Math.random() * 20 - 10);
  lily.style.setProperty('--rot', rotation + 'deg');

  lily.appendChild(makeLilySVG());
  garden.appendChild(lily);

  // Usar requestAnimationFrame para melhor performance
  requestAnimationFrame(() => {
    lily.classList.add('pop');
  });
}

function handle(e){
  // Previne comportamentos padr√£o
  e.preventDefault();
  
  // Obt√©m coordenadas corretas tanto para mouse quanto para toque
  const rect = garden.getBoundingClientRect();
  let x, y;
  
  if (e.type === 'touchstart' || e.type === 'touchmove') {
    x = e.touches[0].clientX - rect.left;
    y = e.touches[0].clientY - rect.top;
    
    // Criar efeito visual de toque
    createTouchIndicator(x, y);
  } else {
    x = e.clientX - rect.left;
    y = e.clientY - rect.top;
  }

  hideHint();
  plantLilyAt(x,y);
}

function hideHint(){
  const h=document.getElementById('clickHint');
  if(h) h.style.display='none';
}

// Eventos para desktop
garden.addEventListener('click', handle);

// Eventos para dispositivos m√≥veis
garden.addEventListener('touchstart', handle, {passive: false});

// Adicionar evento de toque cont√≠nuo para criar v√°rias flores com um gesto
if (hasTouch()) {
  garden.addEventListener('touchmove', handle, {passive: false});
}

resetBtn.addEventListener('click',()=>{
  garden.innerHTML='';
  // Mostra o hint novamente ap√≥s limpar
  const h=document.getElementById('clickHint');
  if(h) h.style.display='block';
});

// Flor inicial
window.addEventListener('load',()=>{
  // Pequeno delay para garantir que o DOM est√° totalmente carregado
  setTimeout(() => {
    const r=garden.getBoundingClientRect();
    plantLilyAt(r.width/2, r.height*0.55);
  }, 100);
});

// Melhorar performance em dispositivos m√≥veis
if (isMobile) {
  // Reduzir o n√∫mero m√°ximo de flores em dispositivos mais fracos
  MAX = 50;
  
  // Otimiza√ß√µes adicionais para iOS
  if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
    document.body.style.webkitTransform = 'translate3d(0,0,0)';
  }
}
</script>
</body>
</html>
